<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Feedback - GEM T2 Controller Optimizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Anonymous Analytics -->
    <script src="js/anonymous-analytics.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="index-new.html" class="flex items-center space-x-2 text-blue-600 hover:text-blue-500">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        <span class="font-medium">Back to App</span>
                    </a>
                    <div class="h-6 w-px bg-gray-300"></div>
                    <h1 class="text-2xl font-bold text-gray-900">Anonymous Feedback</h1>
                </div>
                <div class="text-sm text-gray-500">
                    Help us improve!
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- Privacy Notice -->
        <div class="mb-8 bg-green-50 border border-green-200 rounded-lg p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="h-6 w-6 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-lg font-medium text-green-900">üîí 100% Anonymous Feedback</h3>
                    <p class="text-sm text-green-700 mt-2">
                        Your feedback is completely anonymous. We don't collect any personal information, 
                        IP addresses, or data that could identify you. All responses are stored locally 
                        and aggregated to help improve the GEM T2 Optimizer.
                    </p>
                    <ul class="text-sm text-green-700 mt-2 space-y-1">
                        <li>‚Ä¢ No personal information required</li>
                        <li>‚Ä¢ Responses stored locally on your device</li>
                        <li>‚Ä¢ Data used only to improve features</li>
                        <li>‚Ä¢ Completely optional participation</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Feedback Form -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Share Your Experience</h2>
            
            <form id="feedback-form" class="space-y-6">
                <!-- Overall Experience -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        How would you rate your overall experience with the GEM T2 Optimizer?
                    </label>
                    <div class="flex space-x-2">
                        <label class="flex-1">
                            <input type="radio" name="overall_rating" value="5" class="sr-only peer">
                            <div class="text-center p-3 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-green-100 peer-checked:border-green-500 hover:bg-gray-50 transition-colors">
                                <div class="text-2xl">üòç</div>
                                <div class="text-xs text-gray-600 mt-1">Excellent</div>
                            </div>
                        </label>
                        <label class="flex-1">
                            <input type="radio" name="overall_rating" value="4" class="sr-only peer">
                            <div class="text-center p-3 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-green-100 peer-checked:border-green-500 hover:bg-gray-50 transition-colors">
                                <div class="text-2xl">üòä</div>
                                <div class="text-xs text-gray-600 mt-1">Good</div>
                            </div>
                        </label>
                        <label class="flex-1">
                            <input type="radio" name="overall_rating" value="3" class="sr-only peer">
                            <div class="text-center p-3 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-yellow-100 peer-checked:border-yellow-500 hover:bg-gray-50 transition-colors">
                                <div class="text-2xl">üòê</div>
                                <div class="text-xs text-gray-600 mt-1">Okay</div>
                            </div>
                        </label>
                        <label class="flex-1">
                            <input type="radio" name="overall_rating" value="2" class="sr-only peer">
                            <div class="text-center p-3 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-red-100 peer-checked:border-red-500 hover:bg-gray-50 transition-colors">
                                <div class="text-2xl">üòï</div>
                                <div class="text-xs text-gray-600 mt-1">Poor</div>
                            </div>
                        </label>
                        <label class="flex-1">
                            <input type="radio" name="overall_rating" value="1" class="sr-only peer">
                            <div class="text-center p-3 border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-red-100 peer-checked:border-red-500 hover:bg-gray-50 transition-colors">
                                <div class="text-2xl">üò†</div>
                                <div class="text-xs text-gray-600 mt-1">Terrible</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Features Used -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Which features have you used? (Select all that apply)
                    </label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="features_used" value="pdf_import" class="rounded border-gray-300">
                            <span class="text-sm text-gray-700">PDF Import</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="features_used" value="ai_optimization" class="rounded border-gray-300">
                            <span class="text-sm text-gray-700">AI Optimization</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="features_used" value="manual_settings" class="rounded border-gray-300">
                            <span class="text-sm text-gray-700">Manual Settings</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="features_used" value="profiles" class="rounded border-gray-300">
                            <span class="text-sm text-gray-700">Profile Management</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="features_used" value="weekend_planner" class="rounded border-gray-300">
                            <span class="text-sm text-gray-700">Weekend Planner</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" name="features_used" value="presets" class="rounded border-gray-300">
                            <span class="text-sm text-gray-700">Quick Presets</span>
                        </label>
                    </div>
                </div>

                <!-- Most Valuable Feature -->
                <div>
                    <label for="most_valuable" class="block text-sm font-medium text-gray-700 mb-2">
                        What's the most valuable feature for you?
                    </label>
                    <select id="most_valuable" name="most_valuable" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select a feature...</option>
                        <option value="pdf_import">PDF Import & Auto-population</option>
                        <option value="ai_optimization">AI-Powered Optimization</option>
                        <option value="profile_management">Profile Management</option>
                        <option value="weekend_planning">Weekend Trip Planning</option>
                        <option value="quick_presets">Quick Preset Options</option>
                        <option value="manual_control">Manual Parameter Control</option>
                        <option value="local_storage">Local Data Storage (Privacy)</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <!-- Improvement Suggestions -->
                <div>
                    <label for="improvements" class="block text-sm font-medium text-gray-700 mb-2">
                        What could we improve? (Optional)
                    </label>
                    <textarea id="improvements" name="improvements" rows="4" 
                              placeholder="Share your suggestions for making the optimizer even better..."
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-vertical"></textarea>
                </div>

                <!-- Ease of Use -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        How easy was it to get your GEM configured?
                    </label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="ease_of_use" value="very_easy" class="mr-2">
                            <span class="text-sm text-gray-700">Very easy - worked great on first try</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="ease_of_use" value="easy" class="mr-2">
                            <span class="text-sm text-gray-700">Easy - minor adjustments needed</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="ease_of_use" value="moderate" class="mr-2">
                            <span class="text-sm text-gray-700">Moderate - took some trial and error</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="ease_of_use" value="difficult" class="mr-2">
                            <span class="text-sm text-gray-700">Difficult - needed multiple attempts</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="ease_of_use" value="very_difficult" class="mr-2">
                            <span class="text-sm text-gray-700">Very difficult - couldn't get it working</span>
                        </label>
                    </div>
                </div>

                <!-- Vehicle Information (Anonymous) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Your GEM Configuration (helps us improve compatibility)
                    </label>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label for="gem_model" class="block text-xs text-gray-600 mb-1">GEM Model</label>
                            <select id="gem_model" name="gem_model" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="">Prefer not to say</option>
                                <option value="e2">e2 (2-passenger)</option>
                                <option value="e4">e4 (4-passenger)</option>
                                <option value="e6">e6 (6-passenger)</option>
                                <option value="eS">eS (2-passenger utility)</option>
                                <option value="eL">eL (4-passenger utility)</option>
                                <option value="eM">eM (Mighty Mite)</option>
                                <option value="other">Other/Custom</option>
                            </select>
                        </div>
                        <div>
                            <label for="gem_year" class="block text-xs text-gray-600 mb-1">Year Range</label>
                            <select id="gem_year" name="gem_year" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="">Prefer not to say</option>
                                <option value="2020+">2020+</option>
                                <option value="2016-2019">2016-2019</option>
                                <option value="2010-2015">2010-2015</option>
                                <option value="2005-2009">2005-2009</option>
                                <option value="1999-2004">1999-2004</option>
                                <option value="pre-1999">Pre-1999</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Recommendation -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Would you recommend the GEM T2 Optimizer to other GEM owners?
                    </label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="would_recommend" value="definitely" class="mr-2">
                            <span class="text-sm text-gray-700">Definitely - it's a game changer!</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="would_recommend" value="probably" class="mr-2">
                            <span class="text-sm text-gray-700">Probably - it's helpful overall</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="would_recommend" value="maybe" class="mr-2">
                            <span class="text-sm text-gray-700">Maybe - depends on their needs</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="would_recommend" value="probably_not" class="mr-2">
                            <span class="text-sm text-gray-700">Probably not - needs improvement</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="would_recommend" value="definitely_not" class="mr-2">
                            <span class="text-sm text-gray-700">Definitely not - too many issues</span>
                        </label>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-4 border-t border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-500">
                            Your feedback is valuable and completely anonymous
                        </div>
                        <div class="flex space-x-3">
                            <button type="button" id="clear-form" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                                Clear
                            </button>
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 hover:shadow-md active:bg-blue-800 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span id="submit-text">Submit Feedback</span>
                                <span id="submit-loading" class="hidden">
                                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Submitting...
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </form>

            <!-- Success Message -->
            <div id="success-message" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <div>
                        <h3 class="font-medium text-green-800">Thank you for your feedback!</h3>
                        <p class="text-sm text-green-700 mt-1">
                            Your anonymous responses have been saved locally and will help us improve the GEM T2 Optimizer. 
                            We appreciate you taking the time to share your experience!
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Preview -->
        <div class="mt-8 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Community Feedback Overview</h3>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="total-responses">-</div>
                    <div class="text-sm text-gray-600">Total Responses</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="avg-rating">-</div>
                    <div class="text-sm text-gray-600">Average Rating</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600" id="top-feature">-</div>
                    <div class="text-sm text-gray-600">Most Valued Feature</div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        /**
         * Anonymous Feedback System
         */
        class FeedbackSystem {
            constructor() {
                this.storageKey = 'gem_anonymous_feedback';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateStatistics();
            }

            setupEventListeners() {
                const form = document.getElementById('feedback-form');
                const clearBtn = document.getElementById('clear-form');

                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.submitFeedback();
                });

                clearBtn.addEventListener('click', () => {
                    form.reset();
                });
            }

            async submitFeedback() {
                const form = document.getElementById('feedback-form');
                const submitBtn = form.querySelector('button[type="submit"]');
                const submitText = document.getElementById('submit-text');
                const submitLoading = document.getElementById('submit-loading');
                const successMessage = document.getElementById('success-message');

                // Show loading state
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                submitLoading.classList.remove('hidden');

                try {
                    // Collect form data
                    const formData = new FormData(form);
                    const feedback = this.processFeedbackData(formData);

                    // Save to local storage
                    this.saveFeedback(feedback);

                    // Track in analytics if available
                    if (window.anonymousAnalytics) {
                        window.anonymousAnalytics.trackEvent('feedback_submitted', {
                            rating: feedback.overall_rating,
                            features_count: feedback.features_used.length,
                            has_improvements: feedback.improvements ? 'yes' : 'no'
                        });
                    }

                    // Simulate processing time
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    // Show success
                    form.classList.add('hidden');
                    successMessage.classList.remove('hidden');
                    this.updateStatistics();

                } catch (error) {
                    console.error('Error submitting feedback:', error);
                    alert('There was an error submitting your feedback. Please try again.');
                } finally {
                    // Reset button state
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    submitLoading.classList.add('hidden');
                }
            }

            processFeedbackData(formData) {
                const feedback = {
                    id: 'feedback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    timestamp: new Date().toISOString(),
                    overall_rating: formData.get('overall_rating'),
                    features_used: formData.getAll('features_used'),
                    most_valuable: formData.get('most_valuable'),
                    improvements: formData.get('improvements') || '',
                    ease_of_use: formData.get('ease_of_use'),
                    gem_model: formData.get('gem_model'),
                    gem_year: formData.get('gem_year'),
                    would_recommend: formData.get('would_recommend')
                };

                // Sanitize the improvements text
                if (feedback.improvements) {
                    feedback.improvements = feedback.improvements
                        .replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g, '[EMAIL]')
                        .replace(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g, '[IP]')
                        .substring(0, 500); // Limit length
                }

                return feedback;
            }

            saveFeedback(feedback) {
                try {
                    const existingFeedback = this.getFeedbackData();
                    existingFeedback.responses.push(feedback);
                    existingFeedback.lastUpdated = Date.now();
                    existingFeedback.totalResponses = existingFeedback.responses.length;

                    localStorage.setItem(this.storageKey, JSON.stringify(existingFeedback));
                } catch (error) {
                    console.error('Error saving feedback:', error);
                    throw error;
                }
            }

            getFeedbackData() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    return stored ? JSON.parse(stored) : {
                        version: '1.0',
                        createdAt: Date.now(),
                        lastUpdated: Date.now(),
                        totalResponses: 0,
                        responses: []
                    };
                } catch (error) {
                    console.warn('Error loading feedback data:', error);
                    return {
                        version: '1.0',
                        createdAt: Date.now(),
                        lastUpdated: Date.now(),
                        totalResponses: 0,
                        responses: []
                    };
                }
            }

            updateStatistics() {
                const feedbackData = this.getFeedbackData();
                const responses = feedbackData.responses || [];

                // Total responses
                document.getElementById('total-responses').textContent = responses.length;

                if (responses.length === 0) {
                    document.getElementById('avg-rating').textContent = '-';
                    document.getElementById('top-feature').textContent = '-';
                    return;
                }

                // Average rating
                const ratings = responses
                    .map(r => parseInt(r.overall_rating))
                    .filter(r => !isNaN(r));
                
                if (ratings.length > 0) {
                    const avgRating = (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1);
                    document.getElementById('avg-rating').textContent = avgRating + '/5';
                } else {
                    document.getElementById('avg-rating').textContent = '-';
                }

                // Most valued feature
                const features = {};
                responses.forEach(response => {
                    const feature = response.most_valuable;
                    if (feature && feature !== '') {
                        features[feature] = (features[feature] || 0) + 1;
                    }
                });

                const topFeature = Object.entries(features)
                    .sort(([,a], [,b]) => b - a)[0];
                
                if (topFeature) {
                    const featureName = topFeature[0]
                        .replace(/_/g, ' ')
                        .replace(/\b\w/g, l => l.toUpperCase());
                    document.getElementById('top-feature').textContent = featureName;
                } else {
                    document.getElementById('top-feature').textContent = '-';
                }
            }

            // Export feedback data for review
            exportFeedbackData() {
                const feedbackData = this.getFeedbackData();
                const exportData = {
                    ...feedbackData,
                    exportDate: new Date().toISOString()
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `gem-feedback-export-${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(link.href);
            }
        }

        // Initialize feedback system
        document.addEventListener('DOMContentLoaded', () => {
            window.feedbackSystem = new FeedbackSystem();
        });
    </script>
</body>
</html>